#!/bin/sh

# Auto-detect WM without wmctrl
WM="${XDG_SESSION_DESKTOP:-$DESKTOP_SESSION}"
WM=$(echo "$WM" | tr '[:upper:]' '[:lower:]')

case "$(readlink -f /sbin/init)" in
    *systemd*) ctl='systemctl' ;;
    *) ctl='loginctl' ;;
esac

wmpid() {
    for wm in i3 bspwm dwm xmonad; do
        pid=$(pgrep -x "$wm" | head -n1)
        [ -n "$pid" ] && echo "$pid" && return
    done
}

choice=$(printf "ğŸ”’ lock\nğŸšª leave $WM\nâ™»ï¸ renew $WM\nğŸ» hibernate\nğŸ”ƒ reboot\nğŸ–¥ï¸ shutdown\nğŸ’¤ sleep\nğŸ“º display off" | dmenu -i -p 'Action: ')

case "$choice" in
    'ğŸ”’ lock') slock ;;
    "ğŸšª leave $WM") kill -TERM "$(wmpid)" ;;
    "â™»ï¸ renew $WM") kill -HUP "$(wmpid)" ;;
    'ğŸ» hibernate') slock && $ctl hibernate -i ;;
    'ğŸ’¤ sleep') slock && $ctl suspend -i ;;
    'ğŸ”ƒ reboot') $ctl reboot -i ;;
    'ğŸ–¥ï¸ shutdown') $ctl poweroff -i ;;
    'ğŸ“º display off') xset dpms force off ;;
    *) exit 1 ;;
esac
