# ~/.config/neomutt/keybindings.muttrc
# Vim: filetype=muttrc
# ------------------------------
# Organized Neomutt bindings with Notmuch, sidebar, and macros
# ------------------------------

###################
# General rebindings
###################
bind attach <return> view-mailcap
bind attach l view-mailcap
bind editor <space> noop

###################
# Pager movement (vim-like)
###################
bind pager g noop
bind pager gg top
bind pager G bottom
bind pager j next-line
bind pager k previous-line
bind pager \031 previous-line   # Mouse wheel up
bind pager \005 next-line       # Mouse wheel down

###################
# Index movement (vim-like)
###################
bind index g noop
bind index gg first-entry
bind index G last-entry
bind index j next-line
bind index k previous-line
bind index \031 previous-undeleted
bind index \005 next-undeleted

###################
# Browser movement (vim-like)
###################
bind browser h goto-parent
bind browser l select-entry
bind browser gg first-entry
bind browser G last-entry

###################
# Pager / Browser shared
###################
bind pager,browser gg top-page
bind pager,browser G bottom-page

###################
# Index / Pager shortcuts
###################
bind pager,attach h exit
bind pager l view-attachments
bind index D delete-message
bind index U undelete-message
bind index L limit
bind index h noop
bind index l display-message
bind index,pager R group-reply
bind index,pager @ compose-to-sender
bind index,pager D purge-message
bind index <space> collapse-thread

###################
# Sidebar bindings
###################
bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Co sidebar-open
bind index,pager \Cp sidebar-prev-new
bind index,pager \Cn sidebar-next-new
bind index,pager B sidebar-toggle-visible

###################
# Contacts (Abook integration)
###################
set query_command="abook --mutt-query '%s'"
macro index,pager a "<pipe-message>abook --add-email-quiet<return>" "Add sender to Abook"

###################
# Attachment helpers (ripmime or munpack)
###################

macro index,pager \cb "<pipe-message>/usr/bin/urlscan\n" "Extract URLs from message"
macro attach,compose \cb "<pipe-entry>/usr/bin/urlscan\n" "Extract URLs from entry"
macro attach s '<save-entry>~/Downloads/attachments/' 'Save attachment'

###################
# Account switching macros
###################
# =========================
# Eorus account
# =========================
macro index,pager ,e "<enter-command>set folder=~/Mail/eorus<enter><enter-command>set spoolfile=+INBOX<enter><enter-command>set from=alper@eorus.com<enter><enter-command>set realname='Alper Orus'<enter><change-folder>+INBOX<enter>" "Switch to Eorus"

# =========================
# Gmail account
# =========================
macro index,pager ,g "<enter-command>set folder=~/Mail/gmail<enter><enter-command>set spoolfile=+INBOX<enter><enter-command>set from=alperor@gmail.com<enter><enter-command>set realname='Alper Orus'<enter><change-folder>+INBOX<enter>" "Switch to Gmail"

###################
# Notmuch integration
###################
bind index,pager x modify-labels
macro index \\\\ "<vfolder-from-query>" "Vfolder from query"

# Label macros
macro index A "<modify-labels>+archive -unread -inbox\n"   "Archive message"
macro index I "<modify-labels>+inbox -deleted\n"          "Restore inbox"
macro index S "<modify-labels>+spam -inbox\n"             "Mark as spam"
macro index + "<modify-labels>+flagged\n<sync-mailbox>"   "Star message"
macro index - "<modify-labels>-flagged\n<sync-mailbox>"   "Unstar message"

###################
# Sync / test macros
###################
macro index,pager ,T "<enter-command>echo 'bindings OK'<enter>" "test bindings loaded"
macro index <F5> "<shell-escape>mail-sync<enter>" "sync email"

###################
# Bulk delete helper (example)
###################
# tag all visible, delete them:
macro index,pager \cd ";t;d<enter>" "Tag-visible + delete (careful!)"
macro index,pager \cu ";t;N" "Mark tagged as unread"
