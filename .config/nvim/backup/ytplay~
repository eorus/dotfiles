#!/bin/bash

if [ -z "$1" ]; then
    echo "Usage: $0 <search query>"
    exit 1
fi

QUERY="$*"

# Get top 10 results
RESULTS=$(yt-dlp "ytsearch10:$QUERY" --get-title --get-id | awk 'NR%2{printf "%s\t",$0;next}{print}')

# Use fzf with tab as delimiter
SELECTED=$(echo "$RESULTS" | fzf --with-nth=1 --delimiter=$'\t' --prompt="Select video: ")

if [ -z "$SELECTED" ]; then
    echo "No selection made."
    exit 1
fi

# Extract VIDEO_ID (after tab)
VIDEO_ID=$(echo "$SELECTED" | awk -F'\t' '{print $2}')

mpv "https://www.youtube.com/watch?v=$VIDEO_ID" --ytdl-format="bestvideo[height<=1080]+bestaudio/best" --hwdec=auto
